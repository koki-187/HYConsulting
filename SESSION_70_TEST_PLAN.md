# Session 70: 全国査定システムの包括的エラー調査と修正 - テスト計画

## 実施日時
2026-01-09

## 目的
小平市で発生した価格表示エラー（153,103万円）が全国の他のエリアでも発生していないか包括的に調査し、根本原因を特定して修正する。

## テスト対象エリア

### Phase 1: 全国5エリアでの基本テスト
1. **東京都**
   - 新宿区（マンション）
   - 渋谷区（戸建て）

2. **神奈川県**
   - 横浜市西区（マンション）
   - 川崎市（戸建て）

3. **大阪府**
   - 大阪市北区（マンション）

4. **福岡県**
   - 福岡市博多区（マンション）

5. **北海道**
   - 札幌市中央区（マンション）

### Phase 2: 神奈川県20パターンのランダムテスト
神奈川県内の複数市区町村で、物件種別・面積・築年数をランダムに変更してテスト

## テストケース詳細

### テストケース1: 東京都新宿区マンション
- 物件種別: マンション
- 都道府県: 東京都
- 市区町村: 新宿区
- 最寄り駅: 新宿駅
- 徒歩: 5分
- 面積: 70㎡
- 築年数: 10年

**期待される結果:**
- 査定価格が妥当な範囲（5,000万円～8,000万円程度）
- 価格範囲が中央値の±30%以内
- 物件種別が「マンション」と正しく表示
- 市場トレンドが日本語で表示（安定/上昇/下降）
- 類似取引件数が100件以上

### テストケース2: 東京都渋谷区戸建て
- 物件種別: 戸建て
- 都道府県: 東京都
- 市区町村: 渋谷区
- 面積: 100㎡
- 築年数: 15年

**期待される結果:**
- 査定価格が妥当な範囲（8,000万円～1.5億円程度）
- 価格範囲が中央値の±30%以内
- 物件種別が「戸建て」と正しく表示

### テストケース3: 神奈川県横浜市西区マンション
- 物件種別: マンション
- 都道府県: 神奈川県
- 市区町村: 横浜市西区
- 最寄り駅: 横浜駅
- 徒歩: 5分
- 面積: 70㎡
- 築年数: 8年

**期待される結果:**
- 査定価格が妥当な範囲（4,000万円～7,000万円程度）
- 価格範囲が中央値の±30%以内

### テストケース4: 神奈川県川崎市戸建て
- 物件種別: 戸建て
- 都道府県: 神奈川県
- 市区町村: 川崎市
- 面積: 90㎡
- 築年数: 12年

**期待される結果:**
- 査定価格が妥当な範囲（3,500万円～6,000万円程度）

### テストケース5: 大阪府大阪市北区マンション
- 物件種別: マンション
- 都道府県: 大阪府
- 市区町村: 大阪市北区
- 面積: 75㎡
- 築年数: 10年

**期待される結果:**
- 査定価格が妥当な範囲（3,500万円～6,000万円程度）

### テストケース6: 福岡県福岡市博多区マンション
- 物件種別: マンション
- 都道府県: 福岡県
- 市区町村: 福岡市博多区
- 面積: 70㎡
- 築年数: 8年

**期待される結果:**
- 査定価格が妥当な範囲（2,500万円～4,500万円程度）

### テストケース7: 北海道札幌市中央区マンション
- 物件種別: マンション
- 都道府県: 北海道
- 市区町村: 札幌市中央区
- 面積: 70㎡
- 築年数: 10年

**期待される結果:**
- 査定価格が妥当な範囲（2,000万円～3,500万円程度）

## 検証項目

### 1. 価格表示の妥当性
- [ ] 査定価格が異常に高くない（1億円を大幅に超えない）
- [ ] 査定価格が異常に低くない（0円や負の値でない）
- [ ] 価格範囲（最低価格～最高価格）が妥当（中央値の±30%程度）
- [ ] 単位が正しい（万円表記）

### 2. 物件情報の表示
- [ ] 物件種別が正しく日本語で表示される
- [ ] 所在地が正しく表示される
- [ ] 面積・築年数が正しく表示される

### 3. 市場情報の表示
- [ ] 市場トレンドが日本語で表示される（安定/上昇/下降）
- [ ] 類似取引件数が表示される
- [ ] 信頼度スコアが表示される

### 4. パフォーマンス
- [ ] API応答時間が30秒以内
- [ ] 査定結果が「査定中...」のまま無限ループしない
- [ ] タイムアウトエラーが発生しない

### 5. エラーハンドリング
- [ ] データがないエリアで適切なエラーメッセージが表示される
- [ ] 入力エラーで適切なバリデーションメッセージが表示される

## 発見された問題

### 問題1: 小平市の価格表示エラー
**症状:** 小平市マンション（80㎡、築11年）で153,103万円という異常な価格が表示される

**原因調査:**
- [ ] データベースの小平市データを確認
- [ ] 価格の単位（円 vs 万円）を確認
- [ ] 査定ロジックの計算式を検証
- [ ] 外れ値除外ロジックの動作確認

**修正方針:**
1. データベースの価格単位を確認
2. 査定ロジックの単位変換を確認
3. 外れ値除外の閾値を調整
4. IQR法の実装を確認

## 次のアクション
1. 全国5エリアでテストを実施
2. エラーパターンを特定
3. 根本原因を調査
4. 修正を実施
5. 再テストで検証
6. 神奈川県20パターンテストを実施
7. チェックポイント保存
