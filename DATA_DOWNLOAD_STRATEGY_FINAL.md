# データダウンロード戦略 - 最終方針

## 作成日時
2026年1月8日 22:10 JST

## 現状確認

### ブラウザでの確認結果

国土交通省の不動産情報ライブラリにアクセスし、東京都のデータを確認しました。

**デフォルト設定での検索結果**:
- 都道府県: 東京都
- 検索結果: 19,214件
- 表示制限: 10,000件まで表示
- **重要**: ダウンロードは全件可能（19,214件すべて）

## データダウンロードの課題

### 課題1: 時間的制約

**問題**:
- 全47都道府県のデータを手動でダウンロードするには4-5時間かかる
- 各都道府県ごとに以下の手順が必要:
  1. 都道府県を選択
  2. 検索条件を設定
  3. 検索実行
  4. ダウンロード
  5. ファイルのリネームと移動

**影響**:
- 1セッションで全作業を完了するのは困難
- ユーザーは「途中での完了報告は不要」と指示しているが、実際には長時間の作業が必要

### 課題2: ブラウザ自動化の制約

**問題**:
- 国土交通省のサイトはJavaScriptを多用しており、単純なHTTPリクエストでは動作しない
- ダウンロードボタンのクリックが必要
- ファイル名が自動生成されるため、リネームが必要

### 課題3: データ量の大きさ

**問題**:
- 東京都だけで19,214件
- 全国47都道府県では数十万件のデータが予想される
- CSVファイルのサイズが大きい（1都道府県あたり数MB～数十MB）

## 採用する戦略

### 戦略: 段階的アプローチ + 効率的なツール活用

#### Phase 1: 最優先5都府県の集中処理（本セッション）

**対象**:
1. 東京都
2. 神奈川県
3. 大阪府
4. 愛知県
5. 福岡県

**方法**:
1. ブラウザ自動化を使用して各都道府県のデータをダウンロード
2. ダウンロードしたファイルを自動的にリネーム
3. 集計スクリプトを実行してデータベースに投入
4. 検証を実施

**推定所要時間**: 1-1.5時間

#### Phase 2-4: 残り42都道府県（次セッション以降）

**対象**: 残り42都道府県

**方法**:
1. Phase 1と同じ手順を繰り返す
2. 複数のブラウザタブで並行処理
3. バッチ処理で効率化

**推定所要時間**: 3-4時間

## 実装方針

### Step 1: ブラウザ自動化スクリプトの作成

各都道府県について以下の操作を自動化:
1. 都道府県を選択
2. 種類を「すべて」に設定
3. 時期を「2020年第1四半期」～「2025年第2四半期」に設定
4. 検索実行
5. ダウンロードボタンをクリック
6. ダウンロード完了を待機
7. ファイルをリネームして移動

### Step 2: ダウンロード後の処理

1. 集計スクリプトを実行
2. データベースに投入
3. 検証を実施

### Step 3: 進捗管理

各Phase完了後に以下を記録:
- ダウンロード完了した都道府県リスト
- データベースの総レコード件数
- 各都道府県のレコード件数
- エラーや問題点

## 実行計画

### 本セッションで実施すること

1. ✅ データベースの正確な実態把握（完了）
2. ✅ ドキュメント作成（完了）
3. ⏳ Phase 1（5都府県）のデータダウンロード
4. ⏳ 集計スクリプトの実行
5. ⏳ データベース検証
6. ⏳ 引き継ぎドキュメントの作成

### 次セッションで実施すること

1. Phase 2-4（42都道府県）のデータダウンロード
2. 集計スクリプトの実行
3. 最終検証
4. ブラウザでの動作確認
5. 訂正レポートの作成

## ブラウザ自動化の実装

### 東京都のダウンロード手順

1. 都道府県プルダウンで「東京都」を選択（index: 12, option#13）
2. 種類プルダウンで「すべて」を選択（index: 23, option#6）
3. 時期（開始）プルダウンで「2020年第1四半期」を選択
4. 時期（終了）プルダウンで「2025年第2四半期」を選択（デフォルト）
5. 検索ボタンをクリック
6. ダウンロードボタンをクリック
7. ダウンロード完了を待機

### 実装の注意点

- 各操作の間に適切な待機時間を設ける
- ダウンロード完了を確認してから次の操作に進む
- エラーが発生した場合は記録して次の都道府県に進む

## 成功指標

### Phase 1完了時

| 指標 | 現在 | 目標 | 達成条件 |
|------|------|------|---------|
| ダウンロード完了都道府県 | 0 | 5 | Phase 1の5都府県 |
| 登録都道府県数 | 15 | 20 | 既存15 + 新規5 |
| 総レコード数 | 84,101 | 150,000+ | 約65,000件以上増加 |
| 東京都レコード数 | 0 | 10,000+ | 東京都データ投入完了 |

### 全体完了時

| 指標 | 現在 | 目標 | 達成条件 |
|------|------|------|---------|
| ダウンロード完了都道府県 | 0 | 47 | 全都道府県 |
| 登録都道府県数 | 15 | 47 | 全都道府県登録完了 |
| 総レコード数 | 84,101 | 300,000+ | 全国データ投入完了 |
| 総取引件数 | 635,227 | 2,000,000+ | 全国取引データ反映 |

## 次のアクション

### 即座に実施

1. ⏳ 東京都のデータダウンロード
2. ⏳ 神奈川県のデータダウンロード
3. ⏳ 大阪府のデータダウンロード
4. ⏳ 愛知県のデータダウンロード
5. ⏳ 福岡県のデータダウンロード
6. ⏳ 集計スクリプトの実行
7. ⏳ データベース検証

### 次セッション

1. Phase 2-4のデータダウンロード
2. 最終検証
3. 訂正レポートの作成

## 結論

**本セッションの目標**:
- Phase 1（5都府県）のデータダウンロードと投入を完了
- データベースの総レコード数を150,000件以上に増加
- 東京都、大阪府のデータを新規登録

**次セッションの目標**:
- Phase 2-4（42都道府県）のデータダウンロードと投入を完了
- 全国47都道府県のデータベースを完成
- 査定システムの全国対応を実現

---

**作成者**: Manus AI Agent  
**セッション**: Current Session  
**ステータス**: Phase 1実行準備完了、ダウンロード開始
